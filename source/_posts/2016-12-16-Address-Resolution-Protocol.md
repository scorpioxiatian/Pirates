---
title: ARP地址解析协议
date: 2016-12-16 11:55:09
tags: [network, protocol]
---

# 简介
[<font size=3>ARP协议</font>](https://en.wikipedia.org/wiki/Address_Resolution_Protocol)是处于[7层网络模型](https://en.wikipedia.org/wiki/OSI_model)中的网络层的协议，协议内容根据IP地址获取物理地址的一个TCP/IP协议。主机发送信息时将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。地址解析协议是建立在网络中各个主机互相信任的基础上的，网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存；由此攻击者就可以向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗。ARP命令可用于查询本机ARP缓存中IP地址和MAC地址的对应关系、添加或删除静态对应关系等。

# ARP工作流程
举个例子，我们假设：
主机A的IP地址为192.168.0.1，mac地址为xx-xx-xx-xx-xx-01;
主机B的IP地址为192.168.0.2，mac地址为xx-xx-xx-xx-xx-02;
当主机A需要与主机B通信时，地址解析协议需要将主机B的IP地址解析成主机B的物理地址（即mac地址，我们知道所有设备都有一个
唯一的mac地址），这样根据实际的物理地址两个主机才能够相互通信。以下是工作流程：
1. 首先主机A会确定用于访问主机B的转发IP地址是192.168.0.2（根据本地解析，或者域名解析等）。然后A主机在自己的本地ARP缓存中检查主机B的匹配MAC地址。
2. 如果主机A在ARP缓存中没有找到映射，它将询问192.168.0.2的硬件地址，从而将ARP请求帧广播到本地网络上的所有主机。源主机A的IP地址和MAC地址都包括在ARP请求中。本地网络上的每台主机都接收到ARP请求并且检查是否与自己的IP地址匹配。如果主机发现请求的IP地址与自己的IP地址不匹配，它将丢弃ARP请求。
3. 主机B确定ARP请求中的IP地址与自己的IP地址匹配，则将主机A的IP地址和MAC地址映射添加到本地ARP缓存中。
4. 主机B将包含其MAC地址的ARP回复消息直接发送回主机A。
5. 当主机A收到从主机B发来的ARP回复消息时，会用主机B的IP和MAC地址映射更新ARP缓存。本机缓存是有生存期的，生存期结束后，将再次重复上面的过程。主机B的MAC地址一旦确定，主机A就能向主机B发送IP通信了。

# ARP命令实用
查看arp命令帮助：
```bash
man arp
```
<font size=4>***ARP常用命令选项***：</font>
<font size=3>arp -a / arp -g</font>
查看地址缓存中的所有项目
<font size=3>arp -a IP</font>
如果我们有多个网卡，那么使用arp -a加上接口的IP地址，就可以只显示与该接口相关的ARP缓存项目。
<font size=3>arp -s/-S IP ether_addr(物理地址)</font>
配置本地ARP缓存，如果目标物理地址配置错误，将导致主机间无法通信。(可以尝试下如果配置一个错误地址是ping不通的), 参数-S含义是如果添加的地址已经存在，会将其先删除再添加
<font size=3>arp -d IP</font>
删除一个ARP缓存条目
> 更多使用方法可以通过帮助命令查看，非常全面。前提是英语得过关😅
